import"./main-C4_tj5mD.js";import"./api-DgY0GA1A.js";document.addEventListener("DOMContentLoaded",async function(){if(typeof Api>"u"){console.error("API Utility not loaded"),window.location.href="login.html";return}if(!Api.isAuthenticated()){window.location.href="login.html";return}const t=JSON.parse(localStorage.getItem("user")),o=document.querySelectorAll(".user-name"),e=document.querySelectorAll(".user-role"),s=document.querySelectorAll(".user-avatar");if(t){o.forEach(i=>i.textContent=t.fullName),e.forEach(i=>i.textContent=t.role==="PRACTITIONER"?"Ayurveda Specialist":"Patient");const a=t.fullName.split(" ").map(i=>i[0]).join("").substring(0,2).toUpperCase();s.forEach(i=>i.textContent=a)}document.querySelectorAll('a[href="index.html"]').forEach(a=>{a.textContent.includes("Sign Out")&&a.addEventListener("click",i=>{i.preventDefault(),Api.logout()})});const r=document.querySelectorAll(".sidebar-link"),d=document.querySelectorAll(".dashboard-view"),l=document.getElementById("viewTitle"),c=document.getElementById("sidebar"),m=document.getElementById("sidebarToggle"),f={overview:"Dashboard Overview",patients:"Patient Management",appointments:"Appointments",prescriptions:"Prescriptions",analytics:"Analytics & Reports",settings:"Settings"};m&&m.addEventListener("click",()=>{c.classList.toggle("active")}),r.forEach(a=>{a.addEventListener("click",function(i){i.preventDefault();const p=this.dataset.view;r.forEach(u=>u.classList.remove("active")),this.classList.add("active"),d.forEach(u=>u.classList.remove("active"));const v=document.getElementById(`view-${p}`);v&&v.classList.add("active"),l&&(l.textContent=f[p]||"Dashboard"),window.innerWidth<=768&&c&&c.classList.remove("active")})});try{await g(t.role)}catch(a){console.error("Failed to load dashboard data:",a)}});async function g(t){try{const e=(await Api.get("/appointments")).data.appointments;h(e,t),y(e)}catch(o){console.error("Error fetching appointments:",o)}}function h(t,o){const e=document.querySelector(".appointments-list");if(!e)return;if(t.length===0){e.innerHTML='<div style="padding: 20px; text-align: center; color: #666;">No scheduled appointments found.</div>';return}const s=t.map(n=>{const d=new Date(n.scheduledAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),l=o==="PRACTITIONER"?n.patient.user.fullName:n.practitioner.user.fullName,c=n.type==="VIDEO"?"Video Consultation":"In-Person Visit";return`
            <div class="appointment-card">
                <div class="appointment-time">
                    <div class="time-indicator ${n.status==="CONFIRMED"?"active":""}"></div>
                    <span>${d}</span>
                </div>
                <div class="appointment-info">
                    <div class="patient-name">${l}</div>
                    <div class="appointment-type">${c}</div>
                </div>
                <div class="appointment-actions">
                    ${o==="PRACTITIONER"?'<button class="action-btn primary">Start</button>':""}
                    <button class="action-btn">Reschedule</button>
                    ${n.meetingLink?`<a href="${n.meetingLink}" target="_blank" class="action-btn" style="text-decoration:none; color:inherit;">Join</a>`:""}
                </div>
            </div>
        `}).join("");e.innerHTML=s}function y(t){const o=t.filter(s=>{const n=new Date(s.scheduledAt),r=new Date;return n.getDate()===r.getDate()&&n.getMonth()===r.getMonth()}).length;document.querySelector(".stat-value:nth-of-type(2)");const e=document.querySelectorAll(".stat-card");if(e.length>=2){const s=e[1].querySelector(".stat-value");s&&(s.textContent=o)}}
